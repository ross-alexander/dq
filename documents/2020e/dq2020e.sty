\ProvidesPackage{dq2020e}[2025/12/01 v1.3 DQ style file]
\typeout{DQ Rules style sheet, version 1.3 <December 1, 2025>}

\NeedsTeXFormat{LaTeX2e}

\RequirePackage{geometry}
\RequirePackage{fontspec}
\RequirePackage{ifthen}
\RequirePackage{multicol}
\RequirePackage[dvipsnames]{xcolor}
\RequirePackage{graphicx}
\RequirePackage{fancyhdr}
\RequirePackage{enumitem}
\RequirePackage{tabularray}
\RequirePackage{setspace}
\RequirePackage{titlesec}
\RequirePackage{hyperref}
\RequirePackage[skip=2pt plus 2pt minus 1pt, indent=0mm]{parskip}


%% Need lots of space on the page for 3 columns, no margin notes

\geometry{paper=a4paper,top=10mm,headsep=2mm,left=9mm,right=9mm,bottom=6mm,footskip=3mm}

%% Extra commands for tables

\newcommand{\mi}{\textminus{} }
\newcommand{\pl}{+ }

%% ----------------------------------------------------------------------
%%
%% Select typeface via fontspec
%%
%% ----------------------------------------------------------------------

%% \setmainfont{Linux Libertine O}[Scale=0.8,Color=violet,Ligatures=TeX]
%% \setsansfont{Linux Biolinum O}[Scale=0.7,Color=red,Ligatures=TeX]

\setmainfont{TeX Gyre Pagella}[Scale=0.75,Ligatures=TeX]
\setsansfont{TeX Gyre Adventor}[Scale=0.7,Color=red,Ligatures=TeX]

%% ----------------------------------------------------------------------
%%
%% Front page stuff
%%
%% ----------------------------------------------------------------------

\newcommand{\coverpic}{\includegraphics[scale=1.0]{cover.pdf}}

\newenvironment{Contributors}[0]%
{\begin{center}{\Large \textbf{Contributors}}\end{center}\begin{multicols}{6}}%
{\end{multicols}}

\newenvironment{Copyright}[0]%
{\begin{center}{\Large \textbf{Copyright}}\end{center}\begin{center}}%
{\end{center}}


%% ----------------------------------------------------------------------
%%
%% Additional environments
%%
%%
%% ----------------------------------------------------------------------

\newenvironment{Chapter}[1]{\chapter{#1}\begin{multicols}{3}}{\end{multicols}}
\newenvironment{example}[0]{\small \emph{Example}\hspace{1.2em}}{}

\newenvironment{talent}[2][]{\ifthenelse{\equal{#1}{\empty}}{\subsubsection{#2}}{\subsubsection{#2 (#1)}}\index{talents!#2}}{}
\newenvironment{talent*}[2][]{\ifthenelse{\equal{#1}{\empty}}{\subsubsection{#2}}{\subsubsection{#2 (#1)}}\index{talents!#2}}{}

\newenvironment{spell}[2][]{\ifthenelse{\equal{#1}{\empty}}{\subsubsection{#2}}{\subsubsection{#2 (#1)}}\index{spells!#2}}{}
\newenvironment{spell*}[2][]{\ifthenelse{\equal{#1}{\empty}}{\subsubsection{#2}}{\subsubsection{#2 (#1)}}\index{spells!#2}}{}

\newenvironment{ritual}[2][]{\ifthenelse{\equal{#1}{\empty}}{\subsubsection{#2}}{\subsubsection{#2 (#1)}}\index{rituals!#2}}{}
\newenvironment{ritual*}[2][]{\ifthenelse{\equal{#1}{\empty}}{\subsubsection{#2}}{\subsubsection{#2 (#1)}}\index{rituals!#2}}{}

\newenvironment{effects}[0]{\emph{Effects: }}{}

\newenvironment{College}[4][1.0]%
{\chapter{The College of #3 (Ver #1)}\label{#2}\label{college:#2}\def\dq@college{#3} \index{colleges!\dq@college|(} \begin{multicols*}{3}}%
{\index{colleges!\dq@college|)}\end{multicols*}}

\newenvironment{Skill}[3][1.0]%
{\chapter{#3 (Ver #1)}\label{#2}\label{skill:#2}\def\dq@skill{#3} \index{skills!\dq@skill||} %%
\begin{multicols*}{3}}%
{\end{multicols*}}

\newenvironment{Tables}[1]{\chapter{#1}}{}

\newcommand{\sItem}[2]{\emph{#1}: #2 \\}
\newcommand{\range}[1]{\sItem{Range}{#1}}
\newcommand{\area}[1]{\sItem{Area}{#1}}
\newcommand{\multiple}[1]{\sItem{Experience Multiple}{#1}}
\newcommand{\basechance}[1]{\sItem{Base Chance}{#1}}
\newcommand{\duration}[1]{\sItem{Duration}{#1}}
\newcommand{\resist}[1]{\sItem{Resist}{#1}}
\newcommand{\target}[1]{\sItem{Target}{#1}}
\newcommand{\storage}[1]{\sItem{Storage}{#1}}
\newcommand{\material}[1]{\sItem{Material}{#1}}
\newcommand{\casttime}[1]{\sItem{Cast Time}{#1}}
\newcommand{\actions}[1]{\sItem{Actions}{#1}}
\newcommand{\concentration}[1]{\sItem{Concentration Check}{#1}}
\newcommand{\materialcost}[1]{\sItem{Material Cost}{#1}}
\newcommand{\basetime}[1]{\sItem{Base Construction Time}{#1}}
\newcommand{\timetaken}[1]{\sItem{Time}{#1}}
\newcommand{\rune}[1]{\sItem{Runes}{#1}}

\newcommand{\precis}[1]{{\reset@font\rmfamily\bfseries #1}}


%% Add wrapper around inline tabular

\newenvironment{inline}{\smallskip\setlength\parskip{0pt}}{\smallskip}

%% ----------------------------------------------------------------------
%%
%% header and footer
%%
%% ----------------------------------------------------------------------

\newcommand{\thisday}{\slshape\fontsize{8}{9pt}\selectfont{\MakeUppercase{\today}}}
\pagestyle{fancyplain}
\lhead[\fancyplain{}{\slshape\fontsize{8}{9pt}\selectfont\rightmark}]{\fancyplain{}{\thisday}}
\rhead[\fancyplain{}{\thisday}]{\fancyplain{}{\slshape\fontsize{8}{9pt}\selectfont\rightmark}}
\cfoot{\fancyplain{}{\fontsize{8}{9pt}\selectfont\thepage}}
\renewcommand\headrulewidth{0.0pt}
\renewcommand\footrulewidth{0.0pt}
\renewcommand\footruleskip{0.0pt}

%% Reduce spacing between lines (using setspace package)

\setstretch{0.9}

%% Limit section numbering to chapter.section

\setcounter{secnumdepth}{1}
\setcounter{tocdepth}{1}

%% ----------------------------------------------------------------------
%%
%% New lists with enumitem
%%
%% ----------------------------------------------------------------------

%% use enumitem to reduce space (from enumitem)

\setlist[enumerate]{leftmargin=*,nosep}
\setlist[itemize]{leftmargin=*,nosep}
\setlist[description]{nosep,leftmargin=0pt,font=\bfseries}

\newlist{Itemize}{itemize}{3}
\setlist[Itemize]{label=\textbullet,leftmargin=*,nosep}

\newlist{Enumerate}{enumerate}{3}
\setlist[Enumerate]{label=\arabic*,labelindent=4pt,labelwidth=2em,leftmargin=*,nosep}

\newlist{Description}{description}{3}
\setlist[Description]{nosep,leftmargin=0pt,font=\bfseries}

%% ----------------------------------------------------------------------
%%
%% Use titlesec
%%
%% ----------------------------------------------------------------------

\titleformat{\chapter}[block]
{\Huge\sffamily\bfseries}          % Format of label & text
{\MakeUppercase{\thechapter}}      % Label
{1pc}                              % Sep
{}                                 % Before

\titlespacing*{\chapter}{0pt}{-6mm}{-2mm} % left, before sep, after sep

\titleformat{\section}{\reset@font\large\sffamily\bfseries}{\thesection}{1em}{}
\titlespacing*{\section}{0pt}{6pt plus 4pt minus 4pt}{0.2pt}

\titleformat{\subsection}{\sffamily\bfseries}{}{0pt}{}
\titlespacing*{\subsection} {0pt}{6pt plus 4pt minus 4pt}{0.25\baselineskip}

\titleformat{\subsubsection}{\sffamily\bfseries}{}{0pt}{}
\titlespacing*{\subsubsection} {0pt}{4pt minus 2pt}{0.25\baselineskip}

%% ----------------------------------------------------------------------
%%
%% Add new tblr environment from tabularray
%%
%% ----------------------------------------------------------------------

\NewTblrEnviron{dqtblr}
\SetTblrInner[dqtblr]{hlines={green7},rowsep=0.1mm,width=\linewidth}
\UseTblrLibrary{varwidth}

%% ----------------------------------------------------------------------
%%
%% Set length between label in contents
%%
%% ----------------------------------------------------------------------

\usepackage{tocloft} % to configure the ToC <<<<<
\setlength{\cftsecnumwidth}{2.8em}% set the width to the section number in the ToC <<<<<
\setlength{\cftbeforetoctitleskip}{0.0em}
\setlength{\cftaftertoctitleskip}{2.0mm}
\renewcommand{\cfttoctitlefont}{\Huge \sffamily \bfseries}

%% ----------------------------------------------------------------------
%%
%% hyperref
%%
%% ----------------------------------------------------------------------

\hypersetup{colorlinks=true,allcolors=red,
    bookmarksnumbered=true,     
    bookmarksopen=true,         
    bookmarksopenlevel=1,
    pdfstartview=Fit,pdfpagemode=UseOutlines
}

%% Set whitspace control

\setcounter{columnbadness}{2000}
\setcounter{finalcolumnbadness}{2000}
\setcounter{collectmore}{100}
